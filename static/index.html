<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Go Live CPU + Memory Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: system-ui, Segoe UI, Roboto, Arial;
            margin: 18px
        }
    </style>
</head>

<body>
    <h1>CPU & Memory Usage</h1>
    <canvas id="chart" width="900" height="360"></canvas>
    <script>
        const ctx = document.getElementById('chart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    { label: 'CPU %', data: [], yAxisID: 'y1', fill: false },
                    { label: 'Alloc MiB', data: [], yAxisID: 'y2', fill: false }
                ]
            },
            options: {
                animation: false,
                scales: {
                    y1: { type: 'linear', position: 'left', min: 0, max: 100 },
                    y2: { type: 'linear', position: 'right' }
                }
            }
        });

        async function update() {
            const res = await fetch('/metrics');
            const data = await res.json();
            const ts = new Date(data.timestampMs).toLocaleTimeString();

            chart.data.labels.push(ts);
            chart.data.datasets[0].data.push(Number(data.cpuPercent.toFixed(2)));
            chart.data.datasets[1].data.push(Number((data.alloc / 1024 / 1024).toFixed(2)));

            if (chart.data.labels.length > 120) {
                chart.data.labels.shift();
                chart.data.datasets.forEach(d => d.data.shift());
            }
            chart.update();
        }
        setInterval(update, 1000);
        update();
    </script>
</body>

</html>